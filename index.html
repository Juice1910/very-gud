<script>
  const quotes = [
    // Common
    { text: "ก็มีแต่โจรเท่านั้นแหละที่ลักจริง", rarity: "common" },
    { text: "โตขึ้นถึงได้รู้ว่า โลกไม่ได้สวยงามเหมือนเรา", rarity: "common" },
    { text: "อาจจะยังน้า", rarity: "common" },
    { text: "เป็นคนไม่เอาถ่าน เพราะที่บ้านมีเตาเเก๊ส", rarity: "common" },
    { text: "แมวที่อยู่ในน้ำคือแมวดำ เพราะแมวดำ น้ำ", rarity: "common" },
    { text: "มดอะไรหายาก ม่ดแล่ว", rarity: "common" },
    { text: "ผมหยิกเจ็บมั้ย", rarity: "common" },
    { text: "ไหอะไรสีแดง... ไหจัว", rarity: "common" },
    { text: "แมวอะไรห้ามขับรถ...แมวล้าว", rarity: "common" },
    // Rare
    { text: "สุ่มใหม่ๆ", rarity: "rare" },
    { text: "ทะเลก็เหมือนไก่ กะต้ากๆ", rarity: "rare" },
    { text: "เรื่องรักไม่ค่อยชอบ แต่ถ้ามีหมูกรอบเรียกเราด้วย", rarity: "rare" },
    { text: "เพิ่งรู้ตัวว่าสายเกินไป ก็ตอนที่ตื่นมาตอนเที่ยงนี่แหละ", rarity: "rare" },
    { text: "ไม่ต้องมีหรอก six pack มีแต่ snack ก็ได้ใจแล้ว", rarity: "rare" },
    { text: "ลิงอะไรปวดท้อง...ลิงชิมเปนซี", rarity: "rare" },
    { text: "พระอะไรกินได้...พะโล้", rarity: "rare" },
    // Epic
    { text: "คิดว่าตัวเองสูง 180 มาตลอด พอไปวัดเท่านั้นแหละ เจอพระ", rarity: "epic" },
    { text: "ได้ legendary ยัง", rarity: "epic" },
    { text: "มีด (คำคม)", rarity: "epic" },
    { text: "ชีวิตคือการเดินทาง แต่ถ้าง่วงให้นอนก่อน", rarity: "epic" },
    { text: "กาอะไรช้า กาดึบ", rarity: "epic" },
    { text: "ถ้ามีผมระวังจอพังนะ เพราะไหล่โดนจอ", rarity: "epic" },
    { text: "ช่วงนี้ล้มบ่อย หรือเป็นเพราะหล่อลื่น", rarity: "epic" },
    // Legendary
    { text: "ไปดูดวงมา หมอดูทักว่า สวัสดี", rarity: "legendary" },
    { text: "ข้าวที่กินยากคือข้าวมันไกล", rarity: "legendary" },
    { text: "ใบไม้ยังมีวันร่วงแล้วคนง่วงอย่างผมจะเหลืออะไร", rarity: "legendary" },
    { text: "หมออะไรกินได้...หมอยู หมูยอ", rarity: "legendary" },
    { text: "คำคมก็ต้องคิด คณิตก็ต้องทำ", rarity: "legendary" }
  ];

  const rarities = [
    { name: "common", chance: 45 },
    { name: "rare", chance: 30 },
    { name: "epic", chance: 15 },
    { name: "legendary", chance: 10 }
  ];

  let lastQuote = null;

  function startRoll() {
    const box = document.getElementById("rarityBox");
    const quoteBox = document.getElementById("quoteBox");
    quoteBox.style.opacity = 0;
    box.style.display = "block";

    let cycles = 20; 
    let i = 0;

    let rollInterval = setInterval(() => {
      const r = rarities[Math.floor(Math.random() * rarities.length)];
      box.textContent = r.name.toUpperCase();
      box.className = r.name;

      i++;
      if (i >= cycles) {
        clearInterval(rollInterval);
        
        const finalRarity = getRarity();
        box.textContent = finalRarity.toUpperCase();
        box.className = finalRarity;

        setTimeout(() => {
          const filtered = quotes.filter(q => q.rarity === finalRarity);

          let finalQuote;
          do {
            finalQuote = filtered[Math.floor(Math.random() * filtered.length)];
          } while (finalQuote === lastQuote && filtered.length > 1);

          lastQuote = finalQuote;

          quoteBox.textContent = finalQuote.text;
          quoteBox.style.opacity = 1;
        }, 500);
      }
    }, 100);
  }

  function getRarity() {
    let rnd = Math.random() * 100;
    let sum = 0;
    for (let r of rarities) {
      sum += r.chance;
      if (rnd < sum) return r.name;
    }
    return "common";
  }
</script>
